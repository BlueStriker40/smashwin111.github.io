<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title> </title>
</head>

<body>

  <h1> Hello <span id="clientName"> </span> </h1>  
  <p> What is your current mood? </p>
  <div>
    <input type="text" id="clientStatus" maxlength="100">
    <button onclick="updateMyStatus()">Submit</button>
  </div>
  <p>Other people's moods: </p>
  <div id="messages"> </div>
  
</body>

<script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDaHs9ntxRH2E1eV97UHCp2xhSSev_7_vY",
    authDomain: "dsnsdk-cea95.firebaseapp.com",
    databaseURL: "https://dsnsdk-cea95.firebaseio.com",
    projectId: "dsnsdk-cea95",
    storageBucket: "dsnsdk-cea95.appspot.com",
    messagingSenderId: "257952534169"
  };
  firebase.initializeApp(config);
  
  function login() {
   function newLoginHappened(user) {
     if (user) {            //if the user that was typed in exists:
       app(user)            //then app runs with user info in it
     } else {               //else get the user to log-in using their google acct
       var provider = new firebase.auth.GoogleAuthProvider();
       firebase.auth().signInWithRedirect(provider)
     }
   }
   firebase.auth().onAuthStateChanged(newLoginHappened)   //run newLoginHappened function anytime new authorization
  }
  
  function app(user) {
    //user.displayName
    //user.email
    //user.photoURL
    //user.uid
    document.getElementById("clientName").innerHTML = user.displayName;
    
    function updateMyStatus() {
      var myUpdate = {}   //this object is about to be populated
      myUpdate.email = user.email
      myUpdate.displayName = user.displayName
      myUpdate.status = document.getElementById("clientStatus").value;
      fb.child(user.uid).set(myUpdate);
    }
    var fb = firebase.database().ref('whatsmystatus');
    //document.getElementById("clientStatus").addEventListener("input", updateMyStatus)   //runs the updateMyStatus function on event
  }
  
  window.onload = login;
</script>

</html>
  
